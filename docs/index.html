<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriftWatch | Infrastructure Compliance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0d1117; --card-bg: #161b22; --accent: #58a6ff; --text: #c9d1d9; --neon-green: #3fb950; --neon-red: #f85149; --border: #30363d; --terminal: #010409; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Header & Brand */
        header { text-align: center; padding: 3rem 0; border-bottom: 1px solid var(--border); margin-bottom: 2.5rem; }
        .author-tag { color: var(--accent); font-size: 0.75rem; font-weight: 700; letter-spacing: 0.15rem; text-transform: uppercase; margin-bottom: 0.5rem; display: block; }
        h1 { margin: 0; font-size: 2.75rem; font-weight: 800; }
        .status-pill { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; background: #21262d; border: 1px solid var(--border); margin-top: 10px; }

        /* Dashboard Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2.5rem; }
        .card { background: var(--card-bg); border: 1px solid var(--border); padding: 1.5rem; border-radius: 12px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card h3 { margin: 0; font-size: 0.9rem; color: #8b949e; display: flex; align-items: center; gap: 0.75rem; }
        .card .val { font-size: 3.5rem; font-weight: 800; margin: 1rem 0; transition: color 0.5s; }
        .card.healthy { border-color: var(--neon-green); box-shadow: 0 0 20px rgba(63, 185, 80, 0.1); }
        .card.healthy .val { color: var(--neon-green); }

        /* Terminal Emulator */
        .terminal { background: var(--terminal); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); margin-bottom: 2.5rem; }
        .term-bar { background: #161b22; padding: 10px 18px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .dots { display: flex; gap: 8px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .term-body { height: 400px; overflow-y: auto; padding: 20px; font-family: 'SFMono-Regular', Consolas, monospace; font-size: 0.9rem; scroll-behavior: smooth; }
        
        /* CLI Interaction */
        .cli-line { display: flex; gap: 12px; align-items: center; margin-top: 5px; }
        .prompt { color: var(--neon-green); font-weight: bold; white-space: nowrap; }
        input { background: transparent; border: none; color: #fff; width: 100%; outline: none; font-family: inherit; font-size: inherit; }
        
        /* Roadmap Grid */
        .roadmap-wrapper { margin-top: 3rem; }
        .roadmap-wrapper h2 { margin-top: 0; font-size: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .roadmap-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .rm-category { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .rm-category h3 { margin-top: 0; color: #fff; font-size: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 15px; }
        .rm-item { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; font-size: 0.85rem; line-height: 1.4; color: #8b949e; }
        .rm-item.completed { color: #c9d1d9; }
        .rm-icon { font-size: 1rem; flex-shrink: 0; }
        .rm-icon.completed { color: var(--accent); }
        
        @media (max-width: 768px) { .roadmap-grid { grid-template-columns: 1fr; } }
        footer { text-align: center; margin-top: 4rem; padding: 2rem; color: #8b949e; font-size: 0.8rem; border-top: 1px solid var(--border); }

        .audit-table { width: 100%; margin: 1rem 0; border-collapse: collapse; font-size: 0.85rem; border: 1px solid #30363d; }
        .audit-table th { text-align: left; padding: 12px; background: #161b22; color: #8b949e; }
        .audit-table td { padding: 10px; border-top: 1px solid #30363d; }
        .tag { padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.7rem; border: 1px solid; }
        .tag-missing { border-color: var(--neon-red); color: var(--neon-red); }
        .tag-extra { border-color: #d4e157; color: #d4e157; }
        .btn-action { background: #21262d; border: 1px solid var(--border); color: var(--accent); padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <span class="author-tag">Lead Engineer: Kay Freeman</span>
        <h1>DriftWatch <span style="font-weight: 200; color: #8b949e;">Audit Console</span></h1>
        <div class="status-pill"><i class="fas fa-circle" id="status-dot" style="color: var(--neon-red); font-size: 0.6rem; margin-right: 8px;"></i> <span id="status-text">Live Node: Unsynchronized</span></div>
    </header>

    <div class="stats-grid">
        <div class="card" id="policy-card">
            <h3><i class="fas fa-file-contract"></i> Monitored Policies</h3>
            <div class="val">2</div>
            <div style="font-size: 0.8rem; color: #8b949e;">[infrastructure, web-server]</div>
        </div>
        <div class="card" id="drift-card">
            <h3><i class="fas fa-shield-virus"></i> Active Drifts</h3>
            <div class="val" id="drift-val">3</div>
            <div id="drift-note" style="font-size: 0.8rem; color: #8b949e;">Detection logic: active.</div>
        </div>
    </div>

    <div class="terminal">
        <div class="term-bar">
            <div class="dots">
                <div class="dot" style="background: #ff5f56;"></div>
                <div class="dot" style="background: #ffbd2e;"></div>
                <div class="dot" style="background: #27c93f;"></div>
            </div>
            <div style="font-size: 0.7rem; color: #8b949e;">kayfreeman@driftwatch ~ zsh</div>
            <div>
                <button class="btn-action" onclick="injectCmd('npm start')">npm start</button>
                <button class="btn-action" onclick="injectCmd('npm start -- --fix')">fix</button>
            </div>
        </div>
        <div class="term-body" id="term-body">
            <div style="color: #8b949e; margin-bottom: 1.5rem;">DriftWatch Engine v1.0.4 initialized. Ready for audit...</div>
            <div id="term-output"></div>
            <div class="cli-line">
                <span class="prompt">driftwatch %</span>
                <input type="text" id="cli-input" autofocus autocomplete="off" spellcheck="false">
            </div>
        </div>
    </div>

    <div class="roadmap-wrapper">
        <h2><i class="fas fa-map-signs"></i> Project Roadmap</h2>
        <div id="roadmap-grid" class="roadmap-grid">
            </div>
    </div>

    <footer>
        &copy; 2026 Kay Freeman | MIT License | TypeScript 5.2 | SQLite 3
    </footer>
</div>

<script>
    const input = document.getElementById('cli-input');
    const output = document.getElementById('term-output');
    const body = document.getElementById('term-body');
    const driftVal = document.getElementById('drift-val');
    const driftCard = document.getElementById('drift-card');
    const statusText = document.getElementById('status-text');
    const statusDot = document.getElementById('status-dot');
    const roadmapGrid = document.getElementById('roadmap-grid');

    let state = {
        isHealthy: sessionStorage.getItem('dw_isHealthy') === 'true',
        roadmapData: []
    };

    // --- ROADMAP SYNC ENGINE ---
    async function syncRoadmap() {
        try {
            const response = await fetch('../README.md');
            if (!response.ok) throw new Error('README Load Failed');
            const text = await response.text();

            const section = text.split('## Project Roadmap')[1]?.split('##')[0];
            if (!section) return;

            const categories = section.split('###').filter(c => c.trim() !== "");
            
            state.roadmapData = categories.map(cat => {
                const lines = cat.trim().split('\n');
                const title = lines[0].trim();
                const items = lines.slice(1)
                    .filter(l => l.includes('ðŸ”µ') || l.includes('âšª'))
                    .map(l => ({
                        done: l.includes('ðŸ”µ'),
                        text: l.replace(/[ðŸ”µâšª*]/g, '').trim()
                    }));
                return { title, items };
            });

            renderRoadmap();
        } catch (e) {
            console.error("Sync Error:", e);
            roadmapGrid.innerHTML = `<div style="color:#8b949e; grid-column: 1/-1; text-align:center; padding: 40px; border: 1px dashed var(--border); border-radius:12px;">Waiting for README.md to sync with GitHub Pages...</div>`;
        }
    }

    function renderRoadmap() {
        roadmapGrid.innerHTML = state.roadmapData.map(category => `
            <div class="rm-category">
                <h3>${category.title}</h3>
                ${category.items.map(item => `
                    <div class="rm-item ${item.done ? 'completed' : 'pending'}">
                        <i class="${item.done ? 'fas fa-circle-check rm-icon completed' : 'far fa-circle rm-icon'}"></i>
                        <div>${item.text}</div>
                    </div>
                `).join('')}
            </div>
        `).join('');
    }

    // --- DASHBOARD & CLI LOGIC ---
    function updateDashboard() {
        if (state.isHealthy) {
            driftVal.innerText = '0';
            driftCard.classList.add('healthy');
            statusText.innerText = 'Live Node: Synchronized';
            statusDot.style.color = 'var(--neon-green)';
        }
    }

    function injectCmd(cmd) {
        input.value = cmd;
        handleCommand(cmd);
    }

    const commandLogic = {
        'help': () => `Available:<br>- <span style="color: var(--accent)">npm start</span>: Standard Audit<br>- <span style="color: var(--accent)">npm start -- --fix</span>: Remediation Engine<br>- <span style="color: var(--accent)">npm test</span>: Engine Unit Tests<br>- <span style="color: var(--accent)">npm run history</span>: SQLite Log Stream`,
        'npm start': () => state.isHealthy 
            ? `<span style="color: var(--neon-green)">âœ”</span> All policies synchronized. No drift detected.` 
            : `<table class="audit-table"><tr><th>Resource</th><th>Type</th><th>Rule ID</th></tr><tr><td>infrastructure</td><td><span class="tag tag-missing">MISSING</span></td><td>icmp-echo</td></tr><tr><td>web-server</td><td><span class="tag tag-extra">EXTRA</span></td><td>rogue-exploit</td></tr></table>`,
        'npm start -- --fix': () => {
            state.isHealthy = true;
            sessionStorage.setItem('dw_isHealthy', 'true');
            updateDashboard();
            return `<span style="color: var(--neon-green)">âœ”</span> Remediation successful. System compliant.`;
        },
        'npm test': () => {
            let log = `<b>Running 12 Engine Logic Tests...</b><br>`;
            for(let i=1; i<=12; i++) log += `<span style="color: var(--neon-green)">âœ“</span> Test ${i} Passed<br>`;
            return log + `<br><b>Result: 12/12 Passed.</b>`;
        }
    };

    function handleCommand(val) {
        const cmd = val.trim();
        if(!cmd) return;
        output.innerHTML += `<div class="cli-line"><span class="prompt">driftwatch %</span> ${cmd}</div>`;
        let response = (commandLogic[cmd] || (() => `<span style="color:var(--neon-red)">error:</span> command not found: ${cmd}`))();
        output.innerHTML += `<div style="margin-bottom: 20px; color: #acb1b7;">${response}</div>`;
        input.value = "";
        body.scrollTop = body.scrollHeight;
    }

    input.addEventListener('keydown', (e) => { if(e.key === 'Enter') handleCommand(input.value); });
    
    syncRoadmap();
    updateDashboard();
</script>
</body>
</html>
